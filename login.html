// Inside login.html script
async function handleLogin() {
    const btn = document.getElementById('submit-btn');
    const feedback = document.getElementById('feedback');
    const idInput = document.getElementById('login-id').value;
    const emailInput = document.getElementById('login-email').value;

    btn.innerText = "Verifying...";

    try {
        // --- UPDATED: YOUR SPECIFIC LOGIN WEBHOOK ---
        const response = await fetch('https://my-n8n-server-npma.onrender.com/webhook/db57af1f-0543-49df-8229-7abbd410b6b6', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                email: emailInput, 
                userID: idInput 
            })
        });

        const result = await response.json();

        // Check if n8n approves
        if (result.status === "approved") {
            // Restore the Session
            localStorage.setItem('automania_id', idInput);
            localStorage.setItem('automania_name', result.name || "Agent");

            btn.innerText = "Access Granted";
            btn.style.backgroundColor = "#32D74B";
            
            setTimeout(() => { window.location.href = 'dashboard.html'; }, 1000);
        } else {
            throw new Error("Denied");
        }

    } catch (error) {
        btn.innerText = "Access Denied";
        btn.style.backgroundColor = "#ff3b30";
        feedback.innerText = "ID or Email not found.";
        feedback.style.display = "block";
    }
}
